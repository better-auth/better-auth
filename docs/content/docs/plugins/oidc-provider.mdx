---
title: OIDC Provider
description: Open ID Connect plugin for Better Auth that allows you to have your own OIDC provider.
---

The **OIDC Provider Plugin** enables you to build and manage your own OpenID Connect (OIDC) provider, granting full control over user authentication without relying on third-party services like Okta or Azure AD. It also allows other services to authenticate users through your OIDC provider.

**Key Features**:

- **Client Registration**: Register clients to authenticate with your OIDC provider.
- **Dynamic Client Registration**: Allow clients to register dynamically.
- **Authorization Code Flow**: Support the Authorization Code Flow.
- **JWKS Endpoint**: Publish a JWKS endpoint to allow clients to verify tokens. (Not fully implemented)
- **Refresh Tokens**: Issue refresh tokens and handle access token renewal using the `refresh_token` grant.
- **OAuth Consent**: Implement OAuth consent screens for user authorization, with an option to bypass consent for trusted applications.
- **UserInfo Endpoint**: Provide a UserInfo endpoint for clients to retrieve user details.

<Callout type="warn">
This plugin is in active development and may not be suitable for production use. Please report any issues or bugs on [GitHub](https://github.com/better-auth/better-auth).
</Callout>

## Installation

<Steps>
    <Step>
        ### Mount the Plugin

        Add the OIDC plugin to your auth config. See [OIDC Configuration](#oidc-configuration) on how to configure the plugin.

        ```ts title="auth.ts"
        import { betterAuth } from "better-auth";
        import { oidcProvider } from "better-auth/plugins";

        const auth = betterAuth({
            plugins: [oidcProvider({
                loginPage: "/sign-in", // path to the login page
                // ...other options
            })]
        })
        ```
    </Step>

    <Step>
        ### Migrate the Database

        Run the migration or generate the schema to add the necessary fields and tables to the database.

        <Tabs items={["migrate", "generate"]}>
            <Tab value="migrate">
            ```bash
            npx @better-auth/cli migrate
            ```
            </Tab>
            <Tab value="generate">
            ```bash
            npx @better-auth/cli generate
            ```
            </Tab>
        </Tabs>
        See the [Schema](#schema) section to add the fields manually.
    </Step>

    <Step>
        ### Add the Client Plugin

        Add the OIDC client plugin to your auth client config.

        ```ts
        import { createAuthClient } from "better-auth/client";
        import { oidcClient } from "better-auth/client/plugins"
        const authClient = createAuthClient({
            plugins: [oidcClient({
                // Your OIDC configuration
            })]
        })
        ```
    </Step>
</Steps>

## Usage

Once installed, you can utilize the OIDC Provider to manage authentication flows within your application.

### Register a New Client

To register a new OIDC client, use the `oauth2.register` method.

<Endpoint path="/oauth2/register" method="POST" />

```ts title="client.ts"
const application = await client.oauth2.register({
    name: "My Client",
    redirect_uris: ["https://client.example.com/callback"],
});
```

Once the application is created, you will receive a `client_id` and `client_secret` that you can display to the user.

This Endpoint support [RFC7591](https://datatracker.ietf.org/doc/html/rfc7591) compliant client registration.

### UserInfo Endpoint

The OIDC Provider includes a UserInfo endpoint that allows clients to retrieve information about the authenticated user. This endpoint is available at `/oauth2/userinfo` and requires a valid access token.

<Endpoint path="/oauth2/userinfo" method="GET" />

```ts title="client-app.ts"
// Example of how a client would use the UserInfo endpoint
const response = await fetch('https://your-domain.com/api/auth/oauth2/userinfo', {
  headers: {
    'Authorization': 'Bearer ACCESS_TOKEN'
  }
});

const userInfo = await response.json();
// userInfo contains user details based on the scopes granted
```

The UserInfo endpoint returns different claims based on the scopes that were granted during authorization:

- With `openid` scope: Returns the user's ID (`sub` claim)
- With `profile` scope: Returns name, picture, given_name, family_name
- With `email` scope: Returns email and email_verified

The `getAdditionalUserInfoClaim` function receives the user object and the requested scopes array, allowing you to conditionally include claims based on the scopes granted during authorization. These additional claims will be included in both the UserInfo endpoint response and the ID token.

### Consent Screen

When a user is redirected to the OIDC provider for authentication, they may be prompted to authorize the application to access their data. This is known as the consent screen. By default, Better Auth will display a sample consent screen. You can customize the consent screen by providing a `consentPage` option during initialization.

```ts title="auth.ts"
import { betterAuth } from "better-auth";

export const auth = betterAuth({
    plugins: [oidcProvider({
        consentPage: "/path/to/consent/page"
    })]
})
```

The plugin will redirect the user to the specified path with a `client_id` and `scope` query parameter. You can use this information to display a custom consent screen. Once the user consents, you can call `oauth2.consent` to complete the authorization.

<Endpoint path="/oauth2/consent" method="POST" />

```ts title="server.ts"
const res = await client.oauth2.consent({
	accept: true, // or false to deny
});
```

The `client_id` and other necessary information are stored in the browser cookie, so you don't need to pass them in the request. If they don't exist in the cookie, the consent method will return an error.

### Handling Login

When a user is redirected to the OIDC provider for authentication, if they are not already logged in, they will be redirected to the login page. You can customize the login page by providing a `loginPage` option during initialization.

```ts title="auth.ts"
import { betterAuth } from "better-auth";

export const auth = betterAuth({
    plugins: [oidcProvider({
        loginPage: "/sign-in"
    })]
})
```

You don't need to handle anything from your side; when a new session is created, the plugin will handle continuing the authorization flow.

## Configuration

### OIDC Metadata

Customize the OIDC metadata by providing a configuration object during initialization.

```ts title="auth.ts"
import { betterAuth } from "better-auth";
import { oidcProvider } from "better-auth/plugins";

export const auth = betterAuth({
    plugins: [oidcProvider({
        metadata: {
            issuer: "https://your-domain.com",
            authorization_endpoint: "/custom/oauth2/authorize",
            token_endpoint: "/custom/oauth2/token",
            // ...other custom metadata
        }
    })]
})
```

### JWKS Endpoint (Not Fully Implemented)

For JWKS support, you need to use the `jwt` plugin. It exposes the `/jwks` endpoint to provide the public keys.

<Callout type="warn">
Currently, the token is signed with the application's secret key. The JWKS endpoint is not fully implemented yet.
</Callout>

### Dynamic Client Registration

If you want to allow clients to register dynamically, you can enable this feature by setting the `allowDynamicClientRegistration` option to `true`.

```ts title="auth.ts"
const auth = betterAuth({
    plugins: [oidcProvider({
        allowDynamicClientRegistration: true,
    })]
})
```

This will allow clients to register using the `/register` endpoint to be publicly available.

## Schema

The OIDC Provider plugin adds the following tables to the database:

### OAuth Application

<SchemaDemo
    plugin="oidc-provider"
    includeDefaultUser
    height="large"
    schema={{
        oauthApplication: {
            fields: {
                clientId: { type: "string", required: true },
                clientSecret: { type: "string", required: true },
                name: { type: "string", required: true },
                redirectURLs: { type: "string", required: true },
                metadata: { type: "string", required: false },
                type: { type: "string", required: true },
                disabled: { type: "boolean", required: true },
                userId: { type: "string", required: false, references: { model: "user", field: "id" } },
                createdAt: { type: "Date", required: true },
                updatedAt: { type: "Date", required: true },
            },
        },
        oauthAccessToken: {
            fields: {
                accessToken: { type: "string", required: true },
                refreshToken: { type: "string", required: true },
                accessTokenExpiresAt: { type: "Date", required: true },
                refreshTokenExpiresAt: { type: "Date", required: true },
                clientId: { type: "string", required: true, references: { model: "oauthApplication", field: "clientId" } },
                userId: { type: "string", required: true, references: { model: "user", field: "id" } },
                scopes: { type: "string", required: true },
                createdAt: { type: "Date", required: true },
                updatedAt: { type: "Date", required: true },
            },
        },
        oauthConsent: {
            fields: {
                id: { type: "string", required: true },
                userId: { type: "string", required: true, references: { model: "user", field: "id" } },
                clientId: { type: "string", required: true, references: { model: "oauthApplication", field: "clientId" } },
                scopes: { type: "string", required: true },
                consentGiven: { type: "boolean", required: true },
                createdAt: { type: "Date", required: true },
                updatedAt: { type: "Date", required: true },
            },
        },
    }}
/>

#### `oauthApplication` table fields: 

- `id`: The id of the OAuth application
- `clientId`: The client id of the OAuth application
- `clientSecret`: The client secret of the OAuth application
- `name`: The name of the OAuth application
- `redirectURLs`: The redirect URLs of the OAuth application
- `metadata`: The metadata of the OAuth application
- `type`: The type of the OAuth application
- `disabled`: Whether the OAuth application is disabled
- `userId`: The id of the user who owns the OAuth application
- `createdAt`: The timestamp of when the OAuth application was created
- `updatedAt`: The timestamp of when the OAuth application was last updated  

#### `oauthAccessToken` table fields: 

- `id`: The id of the OAuth access token
- `accessToken`: The access token
- `refreshToken`: The refresh token
- `accessTokenExpiresAt`: The timestamp of when the access token expires
- `refreshTokenExpiresAt`: The timestamp of when the refresh token expires
- `clientId`: The id of the OAuth client
- `userId`: The id of the user who owns the access token
- `scopes`: The scopes of the access token
- `createdAt`: The timestamp of when the access token was created
- `updatedAt`: The timestamp of when the access token was last updated


#### `oauthConsent` table fields:

- `id`: The id of the OAuth consent
- `userId`: The id of the user who gave consent
- `clientId`: The id of the OAuth client
- `scopes`: The scopes of the consent
- `consentGiven`: Whether the consent was given
- `createdAt`: The timestamp of when the consent was created
- `updatedAt`: The timestamp of when the consent was last updated


## Options

**allowDynamicClientRegistration**: `boolean` - Enable or disable dynamic client registration.

**metadata**: `OIDCMetadata` - Customize the OIDC provider metadata.

**loginPage**: `string` - Path to the custom login page.

**consentPage**: `string` - Path to the custom consent page.

**getAdditionalUserInfoClaim**: `(user: User, scopes: string[]) => Record<string, any>` - Function to get additional user info claims.