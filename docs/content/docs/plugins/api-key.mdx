---
title: API Key
description: API Key plugin for Better Auth.
---

The API Key plugin allows you to create and manage API keys for your application. It provides a way to authenticate and authorize API requests by verifying API keys.

## Installation

<Steps>
    <Step>
        ### Add Plugin to the server

        ```ts title="auth.ts"
        import { betterAuth } from "better-auth"
        import { apiKey } from "better-auth/plugins"

        const auth = betterAuth({
            plugins: [ // [!code highlight]
                apiKey() // [!code highlight]
            ] // [!code highlight]
        })
        ```
    </Step>
    <Step>
        ### Migrate the database

        Run the migration or generate the schema to add the necessary fields and tables to the database.

        <Tabs items={["migrate", "generate"]}>
            <Tab value="migrate">
            ```bash
            npx @better-auth/cli migrate
            ```
            </Tab>
            <Tab value="generate">
            ```bash
            npx @better-auth/cli generate
            ```
            </Tab>
        </Tabs>
        See the [Schema](#schema) section to add the fields manually.
    </Step>
    <Step>
        ### Add the client plugin

        ```ts title="auth-client.ts"
        import { createAuthClient } from "better-auth/client"
        import { apiKeyClient } from "better-auth/client/plugins"

        const authClient = createAuthClient({
            plugins: [ // [!code highlight]
                apiKeyClient() // [!code highlight]
            ] // [!code highlight]
        })
        ```
    </Step>

</Steps>

## Usage

### Create an API key

```ts
const data = await authClient.apiKey.create({
  reference: "my_user_id",
  name: "My API Key",
  prefix: "my_app",
  length: 64,
  expires: new Date().getTime() + 1000 * 60 * 60 * 24, // 1 day
  enabled: true,
  rateLimit: {
    enabled: true,
    timeWindow: 1000 * 60, // 1 minute
    limit: 10, // with a limit of 10 requests per minute
  },
});
```

### Verify an API key

To verify an API key, you can use the `apiKey.verify` function provided by the client. The `apiKey.verify` function takes an object with the following properties:

- `key`: The API key to verify.

```ts
const isValid = await authClient.apiKey.verify({
  key: "your_api_key_here",
});
```

### Get an API key

To get an API key, you can use the `apiKey.get` function provided by the client. The `apiKey.get` function takes an object with the following properties:

- `keyId`: The ID of the API key to get.

```ts
const apiKey = await authClient.apiKey.get({
  keyId: "your_api_key_id_here",
});
```

### Update an API key

To update an API key, you can use the `apiKey.update` function provided by the client. The `apiKey.update` function takes an object with the following properties:

- `keyId`: The ID of the API key to update.
- `name`: The new name for the API key.
- `remaining`: The new number of requests remaining.
- `expires`: The new expiration date for the API key.
- `enabled`: Whether the API key is enabled or not.

```ts
const updatedApiKey = await authClient.apiKey.update({
  keyId: "your_api_key_id_here",
  name: "New API Key Name",
  remaining: 100,
  expires: new Date().getTime() + 1000 * 60 * 60 * 24 * 7, // 1 week from now
  enabled: true,
});
```

### List API keys

To list all API keys associated with a reference, you can use the `apiKey.list` function provided by the client. The `apiKey.list` function takes an object with the following properties:

- `reference`: The reference to list API keys for.

```ts
const apiKeys = await authClient.apiKey.list({
  reference: "your_reference_here",
});
```

### Delete all expired API keys

To delete all expired API keys, you can use the `apiKey.deleteAllExpiredApiKeys` function provided by the server auth instance.
This function will delete all API keys that have an expiration date and are expired.

<Callout>
  We automatically delete expired API keys every time any apiKey plugin
  endpoints were called, however they are rate-limited to a 10 second cooldown
  each call to prevent multiple calls to the database.
</Callout>

```ts
await auth.api.apiKey.deleteAllExpiredApiKeys();
```

## Schema

Table: `apiKey`

<DatabaseTable
  fields={[
    {
      name: "id",
      type: "string",
      description: "The ID of the api key.",
      isUnique: true,
      isPrimaryKey: true,
    },
    {
      name: "name",
      type: "string",
      description: "The name of the API key.",
      isOptional: true,
    },
    {
      name: "start",
      type: "string",
      description:
        "The starting characters of the API key. Useful for showing the first few characters of the API key in the UI for the users to easily identify.",
      isOptional: true,
    },
    {
      name: "prefix",
      type: "string",
      description: "The API Key prefix. Stored as plain text.",
      isOptional: true,
    },
    {
      name: "key",
      type: "string",
      description: "The hashed API key itself.",
    },
    {
      name: "userId",
      type: "string",
      description: "The id of the user who created the API key.",
      isForeignKey: true,
    },
    {
      name: "refillInterval",
      type: "number",
      description: "The interval to refill the key in milliseconds.",
      isOptional: true,
    },
    {
      name: "refillAmount",
      type: "number",
      description: "The amount to refill the remaining count of the key.",
      isOptional: true,
    },
    {
      name: "lastRefillAt",
      type: "Date",
      description: "The date and time when the key was last refilled.",
      isOptional: true,
    },
    {
      name: "enabled",
      type: "boolean",
      description: "Whether the API key is enabled.",
    },
    {
      name: "rateLimitEnabled",
      type: "boolean",
      description: "Whether the API key has rate limiting enabled.",
    },
    {
      name: "rateLimitTimeWindow",
      type: "number",
      description: "The time window in milliseconds for the rate limit.",
      isOptional: true,
    },
    {
      name: "rateLimitMax",
      type: "number",
      description:
        "The maximum number of requests allowed within the `rateLimitTimeWindow`.",
      isOptional: true,
    },
    {
      name: "requestCount",
      type: "number",
      description:
        "The number of requests made within the rate limit time window.",
    },
    {
      name: "remaining",
      type: "number",
      description: "The number of requests remaining.",
      isOptional: true,
    },
    {
      name: "lastRequest",
      type: "Date",
      description: "The date and time of the last request made to the key.",
      isOptional: true,
    },
    {
      name: "expiresAt",
      type: "Date",
      description: "The date and time when the key will expire.",
      isOptional: true,
    },
    {
      name: "createdAt",
      type: "Date",
      description: "The date and time the API key was created.",
    },
    {
      name: "updatedAt",
      type: "Date",
      description: "The date and time the API key was updated.",
    },
    {
      name: "metadata",
      type: "Object",
      isOptional: true,
      description: "Any additional metadata you want to store with the key.",
    },
  ]}
/>
