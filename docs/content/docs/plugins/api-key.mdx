---
title: API Key
description: API Key plugin for Better Auth.
---

The API Key plugin allows you to create and manage API keys for your application. It provides a way to authenticate and authorize API requests by verifying API keys.

## Installation

<Steps>
    <Step>
        ### Add Plugin to the server

        ```ts title="auth.ts"
        import { betterAuth } from "better-auth"
        import { apiKey } from "better-auth/plugins"

        const auth = betterAuth({
            plugins: [ // [!code highlight]
                apiKey() // [!code highlight]
            ] // [!code highlight]
        })
        ```
    </Step>
    <Step>
        ### Migrate the database

        Run the migration or generate the schema to add the necessary fields and tables to the database.

        <Tabs items={["migrate", "generate"]}>
            <Tab value="migrate">
            ```bash
            npx @better-auth/cli migrate
            ```
            </Tab>
            <Tab value="generate">
            ```bash
            npx @better-auth/cli generate
            ```
            </Tab>
        </Tabs>
        See the [Schema](#schema) section to add the fields manually.
    </Step>
    <Step>
        ### Add the client plugin

        ```ts title="auth-client.ts"
        import { createAuthClient } from "better-auth/client"
        import { apiKeyClient } from "better-auth/client/plugins"

        const authClient = createAuthClient({
            plugins: [ // [!code highlight]
                apiKeyClient() // [!code highlight]
            ] // [!code highlight]
        })
        ```
    </Step>

</Steps>

## Usage

### Create an API key

To create an API key, you can use the `apiKey.create` function provided by the client. The `apiKey.create` function takes an object with the following properties:

- `identifier`: The identifier of the API key.
- `withoutOwner`: Whether to create the API key without an owner. (Default `false`)
- `remaining`: The number of requests remaining. (Default `null`)
- `prefix`: The prefix of the API key. (Default `undefined`)
- `length`: The length of the API key. (Default `64`)
- `expires`: The expiration date of the API key in Unix timestamp format. (Default `null`)
- `enabled`: Whether the API key is enabled or not. (Default `true`)

<Callout>
  If you're creating an API key without an owner, you must provide the `expires`
  or `remaining` properties.
</Callout>

```ts
const data = await authClient.apiKey.create({
  identifier: "test",
  withoutOwner: true,
  remaining: 10,
  prefix: "test",
  length: 64,
  expires: 1679012000,
  enabled: true,
});
```

### Verifying an API key

```ts
const { valid } = await client.apiKey.verify({
  key: "my-api-key",
});
```

### Updating an API key

You can pass an API key ID to the `apiKey.update` function to update information on the API key.

Properties that can be updated:

- `name`: The name of the API key.
- `remaining`: The number of requests remaining.
- `expires`: The expiration date of the API key in Unix timestamp format.
- `enabled`: Whether the API key is enabled or not.

```ts
await client.apiKey.update({
  keyId: "my-key-id",
  name: "new-name",
  remaining: 10,
  expires: 1679012000,
  enabled: true,
});
```

### Revoking an API key

```ts
await client.apiKey.revoke({
  keyId: "my-key-id",
});
```

### Rerolling an API key

You can pass an API key ID to the `apiKey.reroll` function to reroll the API key.

Additional properties can allow you to configure the rerolled API key:

- `prefix`: The prefix of the API key. (Default `undefined`)
- `length`: The length of the API key. (Default `64`)

<Callout>
  If the API key was created without an owner, then you cannot reroll it as it
  requires authorization to reroll the API key. However, you can look into the
  server-side [force reroll
  function](/docs/plugins/api-key#force-rerolling-an-api-key).
</Callout>

```ts
await client.apiKey.reroll({
  keyId: "my-key-id",
  prefix: "test",
  length: 64,
});
```

### Listing API keys

You can pass an identifier to the `apiKey.list` function to list API keys.

```ts
const data = await authClient.apiKey.list({
  query: {
    identifier: "test",
  },
});
```

### Getting information on an API key

You can pass an API key ID to the `apiKey.get` function to get information on the API key including the key itself.

If an API key was created without an owner, then you cannot get it's information as it requires authorization to get the information.

```ts
const data = await authClient.apiKey.get({
  query: {
    keyId: "my-key-id",
  },
});
```

## Server only functions

### Force rerolling an API key

You can pass an API key ID to the `apiKey.forceReroll` function to force reroll the API key.

The traditional rerolling process requires you to have an active session. This
function on the other hand is ran on the server and will not require an active
session.
This is helpful if you want to have an automatic rerolling process for your API, or if the API key was created without an owner,
then this function is able of rerolling the key as needed.

Additional properties can allow you to configure the ne API key:

- `prefix`: The prefix of the API key. (Default `undefined`)
- `length`: The length of the API key. (Default `64`)

```ts
await auth.api.apiKey.forceReroll({
  keyId: "my-key-id",
  prefix: "test",
  length: 64,
});
```

### Force revoking an API key

You can pass an API key ID to the `apiKey.forceRevoke` function to force revoke the API key.

The traditional revoking process requires you to have an active session. This
function on the other hand is ran on the server and will not require an active
session.
This is helpful if you want to have an automatic revoking process for your API, or if the API key was created without an owner,
then this function is able of revoking the key as needed.

```ts
await auth.api.apiKey.forceRevoke({
  keyId: "my-key-id",
});
```

### Force updating an API key

You can pass an API key ID to the `apiKey.forceUpdate` function to force update information on the API key.

The traditional updating process requires you to have an active session. This
function on the other hand is ran on the server and will not require an active
session.
This is helpful if you want to have an automatic updating process for your API, or if the API key was created without an owner,
then this function is able of updating the key as needed.

Properties that can be updated:

- `name`: The name of the API key.
- `remaining`: The number of requests remaining.
- `expires`: The expiration date of the API key in Unix timestamp format.
- `enabled`: Whether the API key is enabled or not.

```ts
await auth.api.apiKey.forceUpdate({
  keyId: "my-key-id",
  name: "new-name",
  remaining: 10,
  expires: 1679012000,
  enabled: true,
});
```

### Delete all expired API keys

To delete all expired API keys, you can use the `apiKey.deleteAllExpiredApiKeys` function provided by the server auth instance.
This function will delete all API keys that have an expiration date and are expired.

<Callout>
  We automatically delete expired API keys every time any apiKey plugin
  functions were called, however they are rate-limited to a 10 second cooldown
  each call.
</Callout>

```ts
await auth.api.apiKey.deleteAllExpiredApiKeys();
```


## Schema

Table: `apiKey`

<DatabaseTable
  fields={[
    {
      name: "id",
      type: "string",
      description: "The ID of the api key",
      isUnique: true,
      isPrimaryKey: true,
    },
    {
      name: "createdAt",
      type: "Date",
      description: "The date and time the API key was created",
    },
    {
      name: "updatedAt",
      type: "Date",
      description: "The date and time the API key was updated",
    },
    {
      name: "lastVerifiedAt",
      type: "Date",
      description: "The date and time the API key was last verified",
      isOptional: true,
    },
    {
      name: "remaining",
      type: "number",
      description: "The number of requests remaining",
      isOptional: true,
    },
    {
      name: "key",
      type: "string",
      description: "The API key itself",
    },
    {
      name: "identifier",
      type: "string",
      description: "The identifier of the API key",
    },
    {
      name: "ownerId",
      type: "string",
      description: "The ID of the user who owns the API key",
      isForeignKey: true,
      isOptional: true,
    },
    {
      name: "expires",
      type: "number",
      description:
        "The expiration date of the API key in Unix timestamp format",
      isOptional: true,
    },
    {
      name: "name",
      type: "string",
      description: "The name of the API key",
      isOptional: true,
    },
    {
      name: "isEnabled",
      type: "boolean",
      description: "Whether the API key is enabled",
    },
  ]}
/>

## Additional Information

There can be a scenario where an API key has no owner and no expiration date but still has a remaining number of requests.

In this case, if the API key was abandoned and never used again, it would be a waste or resources on your Database.

To prevent this, we have added a `lastVerifiedAt` field to the API key table. This field will be updated every time an API key is verified.

Using this field, you can query and delete any keys that have not been verified in a certain time period.
