---
title: Two-Factor Authentication (2FA)
description: Enhance your app's security with two-factor authentication
---

`OTP & TOTP` `Backup Codes` `Trusted Devices`

## What is Two-Factor Authentication?

Two-Factor Authentication (2FA) adds an extra security step when users log in. Instead of just using a password, they'll need to provide a second form of verification. This makes it much harder for unauthorized people to access accounts, even if they've somehow gotten the password.

This plugin offers two main methods of 2FA:

1. **OTP (One-Time Password)**: A temporary code sent to the user's email or phone.
2. **TOTP (Time-based One-Time Password)**: A code generated by an app on the user's device.

**Additional features include:**
- Generating backup codes for account recovery
- Enabling/disabling 2FA
- Managing trusted devices


## Initial Setup

To get started with Two-Factor Authentication, follow these steps:

<Steps>
    <Step>
        ###  Add the plugin to your auth config:

        ```ts title="auth.ts"
        import { betterAuth } from "better-auth"
        import { twoFactor } from "better-auth/plugins"
        
        export const auth = await betterAuth({
            // ... other config options
            plugins: [
                twoFactor({ 
                    issuer: "my-app"
                })
            ]
        })
        ```
    </Step>
        <Step>

                ### Migrate your database:

                ```bash
                npx better-auth migrate
                ```
        </Step>

        <Step>
        ### Add the client plugin:

        ```ts title="client.ts"
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        
        const client = createAuthClient({
            plugins: [
                twoFactorClient({ 
                    twoFactorPage: "/two-factor" //redirect for two factor verification if enabled // [!code highlight] 
                })
            ]
        })
        ```
        </Step>
</Steps>

## Usage

### Enabling 2FA

To enable two-factor authentication for a user:

```ts title="two-factor.ts"
const enableTwoFactor = async() => {
    const { data, error } = await client.twoFactor.enable()
    if (data) {
        // 2FA has been enabled successfully
    }
}
```


### Sign In with 2FA

When a user with 2FA enabled tries to sign in, you'll need to verify their 2FA code. If they have 2FA enabled, they'll be redirected to the `twoFactorPage` where they can enter their 2FA code.

```ts
const signin = async () => {
    const { data, error } = await client.signIn.email({
        email: "user@example.com",
        password: "password123",
    })
}
```

By default, the user will be redirected to the `twoFactorPage` if they have 2FA enabled. If you want to handle the 2FA verification in place, you can use the `options` parameter.

```ts
const signin = async () => {
    const { data, error } = await client.signIn.email({
        email: "user@example.com",
        password: "password123",
        options: {
            async onSuccess(context) {
                if (context.data.twoFactorRedirect) {
                    // Handle the 2FA verification in place
                }
            }
        }
    })
}
```


### TOTP

TOTP is a time-based one-time password algorithm that generates a code based on the current time. It's a more secure method than OTP because it takes into account the time it takes to generate the code.

#### Getting TOTP URI

After enabling 2FA, you can get the TOTP URI to display to the user.

```ts
const { data, error } = await client.twoFactor.getTotpUri()
if (data) {
    // Use data.totpURI to generate a QR code or display to the user
}
```

#### Generating a QR Code

You can use a library like `qrcode` to generate a QR code from the TOTP URI.

```ts
import { toCanvas } from "qrcode"

toCanvas(document.getElementById('canvas'), data.totpURI)
```

#### Verifying TOTP

After the user has entered their 2FA code, you can verify it

```ts
const verifyTotp = async (code: string) => {
    const { data, error } = await client.twoFactor.verifyTotp({ code })
}
```

### OTP

OTP is a one-time password algorithm that generates a code based on the current time. It's a more secure method than TOTP because it takes into account the time it takes to generate the code.


Before using OTP, you need to setup `sendOTP` function.

```ts title="auth.ts" twoslash
import { betterAuth } from "better-auth"
import { twoFactor } from "better-auth/plugins"

export const auth = await betterAuth({
    database: {
        provider: "sqlite",
        url: "./db.sqlite",
    },
    plugins: [
        twoFactor({
          	otpOptions: {
				async sendOTP(user, otp) {
					console.log({ user, otp });
				},
			},
        })
    ]
})
```

#### Sending OTP

sending otp is done by calling `sendOtp` function. This functino will call your `sendOTP` function that you provide in the `otpOptions` with the otp code and the user.

```ts
const { data, error } = await client.twoFactor.sendOtp()
if (data) {
    // Show the OTP to the user
}
```

#### Verifying OTP

After the user has entered their OTP code, you can verify it

```ts
const verifyOtp = async (code: string) => {
    const { data, error } = await client.twoFactor.verifyOtp({ code })
}
```

### Backup Codes


Backup codes are generated and stored in the database when the user enabled two factor authentication. This can be used to recover access to the account if the user loses access to their phone or email.

#### Generating Backup Codes
Generate backup codes for account recovery:

```ts
const { data, error } = await client.twoFactor.generateBackupCodes()
if (data) {
    // Show the backup codes to the user
}
```

#### Using Backup Codes

Backup codes can be used to recover access to the account if the user loses access to their phone or email.

```ts
const { data, error } = await client.twoFactor.verifyBackupCode({code: ""})
if (data) {
    // 2FA verified and account recovered
}
```

### Trusted Devices

You can mark a device as trusted by passing `trustDevice` to `verifyTotp` or `verifyOtp`.

```ts
const verify2FA = async (code: string) => {
    const { data, error } = await client.twoFactor.verifyTotp({
        code,
        callbackURL: "/dashboard",
        trustDevice: true // Mark this device as trusted
    })
    if (data) {
        // 2FA verified and device trusted
    }
}
```

When `trustDevice` is set to `true`, the current device will be remembered for 60 days. During this period, the user won't be prompted for 2FA on subsequent sign-ins from this device. The trust period is refreshed each time the user signs in successfully.

<Callout type="info">
    Trusted devices enhance user convenience but should be used carefully, as they slightly reduce security. Encourage users to only trust personal, secure devices.
</Callout>

## Configuration

### Server

To configure the two factor plugin, you need to add the following code to your better auth instance.

```ts title="auth.ts" twoslash
import { betterAuth } from "better-auth"
import { twoFactor } from "better-auth/plugins"

export const auth = await betterAuth({
    database: {
        provider: "sqlite",
        url: "./db.sqlite",
    },
    plugins: [ // [!code highlight]
        twoFactor({ // [!code highlight]
            issuer: "my-app" // [!code highlight] 
        }) // [!code highlight]
    ] // [!code highlight]
})
```

**Issuer**: The issuer is the name of your application. It's used to generate totp codes. It'll be displayed in the authenticator apps.

**TOTP options**

these are options for TOTP. 

<TypeTable
  type={{
    digits:{
        description: 'The number of digits the otp to be',
        type: 'number',
        default: 6,
    },
    period: {
        description: 'The period for otp in seconds.',
        type: 'number',
        default: 30,
    },
  }}
/>

**OTP options**

these are options for OTP.

<TypeTable
  type={{
    sendOTP: {
        description: "a function that sends the otp to the user's email or phone number. It takes two parameters: user and otp",
        type: "function",
    },
    period: {
        description: 'The period for otp in seconds.',
        type: 'number',
        default: 30,
    },
  }}
  />

**Backup Code Options**

backup codes are generated and stored in the database when the user enabled two factor authentication. This can be used to recover access to the account if the user loses access to their phone or email.

<TypeTable
    type={{
        amount: {
            description: "The amount of backup codes to generate",
            type: "number",
            default: 10,
        },
        length: {
            description: "The length of the backup codes",
            type: "number",
            default: 10,
        },
        customBackupCodesGenerate: {
            description: "A function that generates custom backup codes. It takes no parameters and returns an array of strings.",
            type: "function",
        },
    }}
/>

### Client 

To use the two factor plugin in the client, you need to add it on your plugins list.

```ts title="client.ts" twoslash
import { createAuthClient } from "better-auth/client"
import { twoFactorClient } from "better-auth/client/plugins"

const client = createAuthClient({
    plugins: [
        twoFactorClient({ // [!code highlight]
            twoFactorPage: "/two-factor" // [!code highlight] 
        }) // [!code highlight]
    ] // [!code highlight]
})
```

**Options**

`twoFactorPage`: The page to redirect the user to after they have enabled 2-Factor. This is the page where the user will be redirected to verify their 2-Factor code.

`redirect`: If set to `false`, the user will not be redirected to the `twoFactorPage` after they have enabled 2-Factor.


## Database Schema

Two factores requires additional fields on the user table. If you use better auth's migration system, it will automatically create this table for you.

```ts
const schema = {
    user: {
        fields: {
            twoFactorEnabled: {
                type: "boolean",
                required: false,
                defaultValue: false,
            },
            twoFactorSecret: {
                type: "string",
                required: false,
            },
            twoFactorBackupCodes: {
                type: "string",
                required: false,
                returned: false,
            },
        },
    },
}
```